(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[63],{"62rO":function(e,t,a){e.exports={tableList:"antd-pro-pages-system-management-certificate-tableList",tableListOperator:"antd-pro-pages-system-management-certificate-tableListOperator",tableListForm:"antd-pro-pages-system-management-certificate-tableListForm",submitButtons:"antd-pro-pages-system-management-certificate-submitButtons",error:"antd-pro-pages-system-management-certificate-error",success:"antd-pro-pages-system-management-certificate-success",warning:"antd-pro-pages-system-management-certificate-warning","progress-pass":"antd-pro-pages-system-management-certificate-progress-pass",progress:"antd-pro-pages-system-management-certificate-progress"}},nq4Y:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,r,i,l,s,o,c,d,p,u,m=a("bx4M"),h=(a("/zsF"),a("PArb")),f=(a("+L6B"),a("2/Rp")),g=a("jehZ"),b=a.n(g),y=(a("5NDa"),a("5rEg")),v=(a("miYZ"),a("tsqr")),w=a("2Taf"),C=a.n(w),V=a("vZ4D"),E=a.n(V),F=a("l4Ni"),M=a.n(F),S=a("ujKo"),R=a.n(S),k=a("MhPg"),L=a.n(k),A=(a("y8nQ"),a("Vl3Y")),D=(a("2qtc"),a("kLXV")),I=a("q1tI"),P=a.n(I),O=a("MuoO"),x=a("wd/R"),B=a.n(x),U=a("CkN6"),q=a("zHco"),N=a("62rO"),T=a.n(N),Y="adminCertificate",j=function(e){var t=e[Y].pageBean,a=e[Y].rows,n=e[Y].loading;return{loading:n,pageBean:t,rows:a}},z=function(e,t){var a=e.map(function(e){return e.name}),n=a.join(", ");D["a"].confirm({title:"\u662f\u5426\u786e\u8ba4\u5220\u9664\u8bc1\u4e66",content:n,okText:"\u662f",okType:"danger",cancelText:"\u5426",onOk:function(){t(e)}})},Z={labelCol:{span:7},wrapperCol:{span:13}},J=(n=A["a"].create(),n((i=function(e){function t(e){var a;return C()(this,t),a=M()(this,R()(t).call(this,e)),a.handleAddModal=function(e){e.preventDefault();var t=a.props.handleAdd;a.props.form.validateFields(function(e,n){e||t({name:n.name,content:n.content,pic:a.state.normalFileName,weight:n.weight})})},a.handlePicChange=function(e){var t=e.fileList;t=t.slice(-1),t=t.map(function(e){return console.log(e),e.response&&1==e.response.result&&(e.url=e.response.url,a.setState({normalFileName:e.response.url})),e}),t=t.filter(function(e){return!(!e.response||1!=e.response.result)}),a.setState({fileList:t})},a.onFileChange=function(e){var t=e.target.files[0];if(t){var n=new FormData;n.append("file",t),fetch("/admin/uploadpic",{method:"POST",header:{"Content-Type":"multipart/form-data"},body:n}).then(function(e){return e.json()}).then(function(e){1!=e.result?v["a"].error("\u4e0a\u4f20\u5931\u8d25"):a.setState({normalFileName:e.url})})}},a.uploadFile=function(e){e.preventDefault(),a.refs.uploadBox.click()},a.state={formVals:{name:"",content:"",weight:""},visible:!1,fileList:[],normalFileName:""},a}return L()(t,e),E()(t,[{key:"render",value:function(){var e=this;this.props.isAddSuccess&&(this.setState({formVals:{},visible:!1}),this.props.handleChangeIsAddSuccess(!1));this.handlePicChange;return P.a.createElement(D["a"],{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:"\u6dfb\u52a0\u65b0\u8bc1\u4e66",visible:this.props.addModalVisible,onOk:this.handleAddModal,onCancel:function(){return e.props.handleAddModalVisible(!1)},afterClose:function(){e.props.handleAddModalVisible()}},P.a.createElement(A["a"].Item,b()({},Z,{label:"\u8bc1\u4e66\u540d\u79f0"}),this.props.form.getFieldDecorator("name",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u540d\u79f0"}]})(P.a.createElement(y["a"],{placeholder:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u540d\u79f0"}))),P.a.createElement(A["a"].Item,b()({},Z,{label:"\u8bc1\u4e66\u7b80\u4ecb"}),this.props.form.getFieldDecorator("content",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u7b80\u4ecb"}]})(P.a.createElement(y["a"],{placeholder:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u7b80\u4ecb"}))),P.a.createElement(A["a"].Item,b()({},Z,{label:"\u8bc1\u4e66\u56fe\u7247"}),P.a.createElement(f["a"],{onClick:this.uploadFile},"\u9009\u62e9\u56fe\u7247")," ",P.a.createElement("br",null),this.state.filename,P.a.createElement("input",{type:"file",id:"uploadFile",name:"file",onChange:this.onFileChange,style:{display:"none"},ref:"uploadBox"})),P.a.createElement(A["a"].Item,b()({},Z,{label:"\u4f18\u5148\u7ea7"}),this.props.form.getFieldDecorator("weight",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u4f18\u5148\u7ea7"},{pattern:/^[0-9]+$/,message:"\u8bf7\u8f93\u5165\u7b26\u5408\u8981\u6c42\u7684\u6570\u503c"}]})(P.a.createElement(y["a"],{placeholder:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u663e\u793a\u4f18\u5148\u7ea7"}))))}}]),t}(P.a.Component),r=i))||r),H=(l=A["a"].create(),l((o=function(e){function t(e){var a;return C()(this,t),a=M()(this,R()(t).call(this,e)),a.handleUpdateModal=function(e){e.preventDefault();var t=a.props,n=(t.form,t.handleUpdate);a.props.form.validateFields(function(e,t){e||n({id:a.props.id,name:t.name,content:t.content,pic:a.state.normalFileName,weight:t.weight})})},a.onFileChange=function(e){var t=e.target.files[0];if(t){var n=new FormData;n.append("file",t),fetch("/admin/uploadpic",{method:"POST",header:{"Content-Type":"multipart/form-data"},body:n}).then(function(e){return e.json()}).then(function(e){1!=e.result?v["a"].error("\u4e0a\u4f20\u5931\u8d25"):a.setState({normalFileName:e.url})})}},a.uploadFile=function(e){e.preventDefault(),a.refs.uploadBox1.click()},a.state={formVals:{name:a.props.record?a.props.record.name:0,content:a.props.record?a.props.record.content:"",weight:a.props.record?a.props.record.weight:""},fileList:[],normalFileName:a.props.record?a.props.record.pic:""},a}return L()(t,e),E()(t,[{key:"render",value:function(){var e=this;return P.a.createElement(D["a"],{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:"\u4fee\u6539\u8bc1\u4e66",onOk:this.handleUpdateModal,visible:this.props.updateModalVisible,onCancel:function(){e.props.handleUpdateModalVisible()}},P.a.createElement(A["a"].Item,b()({},Z,{label:"\u8bc1\u4e66\u540d\u79f0"}),this.props.form.getFieldDecorator("name",{initialValue:this.props.record.name,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u65b0\u7684\u8bc1\u4e66\u540d\u79f0"}]})(P.a.createElement(y["a"],{placeholder:"\u8bf7\u8f93\u5165\u65b0\u7684\u8bc1\u4e66\u540d\u79f0"}))),P.a.createElement(A["a"].Item,b()({},Z,{label:"\u8bc1\u4e66\u7b80\u4ecb"}),this.props.form.getFieldDecorator("content",{initialValue:this.props.record.content,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u7b80\u4ecb"}]})(P.a.createElement(y["a"],{placeholder:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u7b80\u4ecb"}))),P.a.createElement(A["a"].Item,b()({},Z,{label:"\u8bc1\u4e66\u56fe\u7247"}),P.a.createElement(f["a"],{onClick:this.uploadFile},"\u9009\u62e9\u56fe\u7247")," ",P.a.createElement("br",null),this.state.filename,P.a.createElement("input",{type:"file",id:"uploadFile",name:"file",onChange:this.onFileChange,style:{display:"none"},ref:"uploadBox1"})),P.a.createElement(A["a"].Item,b()({},Z,{label:"\u4f18\u5148\u7ea7"}),this.props.form.getFieldDecorator("weight",{initialValue:this.props.record.weight,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u4f18\u5148\u7ea7"},{type:"integer",message:"\u8bf7\u8f93\u5165\u7b26\u5408\u8981\u6c42\u7684\u6570\u503c"}]})(P.a.createElement(y["a"],{placeholder:"\u8bf7\u8f93\u5165\u8bc1\u4e66\u663e\u793a\u4f18\u5148\u7ea7"}))))}}]),t}(P.a.Component),s=o))||s),K=(c=Object(O["connect"])(j,null),d=A["a"].create(),c(p=d((u=function(e){function t(e){var a;return C()(this,t),a=M()(this,R()(t).call(this,e)),a.handleUpdateOneRecord=function(e,t){a.setState({updateModalVisible:!!e,updateRecord:t||{}})},a.openPic=function(e){a.setState({picPreviewIsVisible:!0,picPreviewURL:"/static/pic".concat(e.pic)})},a.columns=[{title:"\u540d\u79f0",dataIndex:"name",render:function(e,t){return P.a.createElement("a",{onClick:function(){return a.openPic(t)}},t.name)}},{title:"\u7b80\u4ecb",dataIndex:"content"},{title:"\u4e0a\u4f20\u65f6\u95f4",dataIndex:"date_pub",render:function(e){return B()(e).format("YYYY-MM-DD")}},{title:"\u64cd\u4f5c",render:function(e,t){return P.a.createElement(I["Fragment"],null,P.a.createElement("a",{onClick:function(){return a.handleUpdateOneRecord(!0,t)}},"\u4fee\u6539"),P.a.createElement(h["a"],{type:"vertical"}),P.a.createElement("a",{onClick:function(){return a.handleDeleteRecordOneLine(!0,t)}},"\u5220\u9664"))}}],a.handleAddModalVisible=function(e){a.setState({addModalVisible:!!e})},a.handleUpdateModalVisible=function(e,t){a.setState({updateModalVisible:!!e,updateRecord:t||{}})},a.deleteFunc=function(e){new Promise(function(t,n){for(var r=function(t){var n={id:e[t].id},r=e[t];a.props.dispatch({type:"".concat(Y,"/deleteOneCert"),payload:n,callback:function(e){1!=e.result&&v["a"].error("\u6761\u76ee\u5220\u9664\u5931\u8d25\uff1a".concat(r.name))}})},i=0;i<e.length;i++)r(i);t()}).then(function(){var e={page:a.props.pageBean.currentPage};a.props.dispatch({type:"".concat(Y,"/queryCert"),payload:e})})},a.handleDeleteRecordOneLine=function(e,t){a.setState({oneLineDeleteModalVisible:!!e,oneLineRecordValue:t||{}}),z([t],a.deleteFunc)},a.handleDeleteRecordLines=function(e){e.preventDefault(),z(a.state.selectedRows,a.deleteFunc)},a.handleModalVisible=function(e){a.setState({modalVisible:!!e})},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.handleChangeIsAddSuccess=function(e){a.setState({isAddSuccess:e})},a.handleAdd=function(e){var t=!1,n={name:e.name,content:e.content,pic:e.pic,weight:e.weight,alive:1};return a.props.dispatch({type:"".concat(Y,"/addCert"),payload:n,callback:function(e){if(1!=e.result)v["a"].error("\u6dfb\u52a0\u9519\u8bef");else{v["a"].success("\u6dfb\u52a0\u6210\u529f"),a.handleAddModalVisible(),a.handleChangeIsAddSuccess(!0);var t={page:a.props.pageBean,currentPage:currentPage};a.props.dispatch({type:"".concat(Y,"/queryCert"),payload:t})}}}),t},a.handleUpdate=function(e){var t=!1,n={id:e.id,name:e.name,content:e.content,pic:e.pic,weight:e.weight,alive:1};return a.props.dispatch({type:"".concat(Y,"/updateCert"),payload:n,callback:function(e){if(1!=e.result)v["a"].error("\u66f4\u65b0\u9519\u8bef");else{v["a"].success("\u66f4\u65b0\u6210\u529f"),a.handleUpdateModalVisible();var t={page:a.props.pageBean.currentPage};a.props.dispatch({type:"".concat(Y,"/queryCert"),payload:t})}}}),t},a.handleStandardTableChange=function(e,t,n){var r=a.props.dispatch,i=(a.state.formValues,{page:e.current});r({type:"".concat(Y,"/queryCert"),payload:i})},a.state={modalVisible:!1,addModalVisible:!1,expandForm:!1,selectedRows:[],formValues:{},stepFormValues:{},updateModalVisible:!1,updateRecord:{},isAddSuccess:!1,oneLineDeleteModalVisible:{},oneLineRecordValue:{},picPreviewIsVisible:!1,picPreviewURL:""},a}return L()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e={page:1};this.props.dispatch({type:"".concat(Y,"/queryCert"),payload:e})}},{key:"render",value:function(){var e=this,t={list:this.props.rows,pagination:{total:this.props.pageBean?this.props.pageBean.total:0,pageSize:10,current:this.props.pageBean?this.props.pageBean.currentPage:1}},a={handleAddModalVisible:this.handleAddModalVisible,handleAdd:this.handleAdd},n={handleUpdateModalVisible:this.handleUpdateModalVisible,handleUpdate:this.handleUpdate},r=this.props.loading;return P.a.createElement(q["a"],{title:"\u8bc1\u4e66\u7ba1\u7406"},P.a.createElement(m["a"],{bordered:!1},P.a.createElement("div",{className:T.a.tableList},P.a.createElement("div",{className:T.a.tableListOperator},P.a.createElement(f["a"],{icon:"plus",type:"primary",onClick:function(){return e.handleAddModalVisible(!0)}},"\u65b0\u589e"),this.state.selectedRows.length>0&&P.a.createElement("span",null,P.a.createElement(f["a"],{onClick:this.handleDeleteRecordLines},"\u6279\u91cf\u5220\u9664"))),P.a.createElement(U["a"],{selectedRows:this.state.selectedRows,loading:r,data:t,columns:this.columns,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange}))),P.a.createElement(J,b()({},a,{addModalVisible:this.state.addModalVisible,isAddSuccess:this.state.isAddSuccess,handleChangeIsAddSuccess:this.handleChangeIsAddSuccess})),P.a.createElement(H,b()({},n,{updateModalVisible:this.state.updateModalVisible,record:this.state.updateRecord})),P.a.createElement(D["a"],{visible:this.state.picPreviewIsVisible,onCancel:function(){e.setState({picPreviewIsVisible:!1})}},P.a.createElement("div",null,P.a.createElement("img",{src:this.state.picPreviewURL,alt:null}))))}}]),t}(P.a.Component),p=u))||p)||p);t["default"]=K}}]);