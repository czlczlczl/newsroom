(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[63],{ck23:function(e,t,n){"use strict";n.r(t);n("IzEo");var a,o,l,r,c=n("bx4M"),s=(n("+L6B"),n("2/Rp")),u=(n("5NDa"),n("5rEg")),p=(n("miYZ"),n("tsqr")),m=n("2Taf"),d=n.n(m),f=n("vZ4D"),h=n.n(f),v=n("l4Ni"),g=n.n(v),y=n("ujKo"),E=n.n(y),b=n("MhPg"),k=n.n(b),w=(n("y8nQ"),n("Vl3Y")),F=n("q1tI"),C=n.n(F),D=n("MuoO"),I=n("usdK"),S=n("GguQ"),M=n.n(S),x=n("zHco"),T="adminModifyAnnouncement",q=function(e){var t=e[T].pageBean,n=e[T].rows;return{pageBean:t,rows:n}},B=(a=Object(D["connect"])(q,null),o=w["a"].create(),a(l=o((r=function(e){function t(e){var n;return d()(this,t),n=g()(this,E()(t).call(this,e)),n.pic=[],n.onFileChange=function(e){var t=e.target.files[0];n.setState({file:t,filename:t?t.name:null})},n.uploadFile=function(e){e.preventDefault(),n.refs.uploadBox.click()},n.initEditor=function(){var e=n.refs.editorElem,t=new M.a(e);n.editor=t,t.customConfig.uploadImgServer="/admin/uploadpic",t.customConfig.uploadImgMaxLength=1,t.customConfig.customUploadImg=function(e,t){if(e[0])if(e[0]){var a={file:e[0]};fetch("/admin/uploadpic",{method:"POST",body:a}).then(function(e){return e.json()}).then(function(e){var a=e.result;a?(t("/static/pic/".concat(e.url)),n.pic.push(e.url)):p["a"].error("\u4e0a\u4f20\u9519\u8bef")})}else p["a"].info("\u8bf7\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u56fe\u7247")},t.create()},n.onSubmit=function(e){e.preventDefault(),n.props.form.validateFields(function(e,t){if(!e){for(var a=new FormData,o="",l=0;l<n.pic.length-1;l++)o=o.concat(n.pic[l]).concat("|");o=o.concat(n.pic[i]),a.append("pic",o),a.append("file",n.state.file),a.append("title",n.values.title),a.append("content",n.editor.txt.html()),fetch("/admin/createannouncement",{method:"POST",body:a}).then(function(e){return e.json()}).then(function(e){if(1!=e.result)p["a"].error("\u65b0\u589e\u5931\u8d25");else{var a={title:t.title};n.props.dispatch({type:"".concat(T,"/modifyTitle"),payload:a,callback:function(){I["a"].push("/systemmanagement/announcement/result")}})}})}})},n.deleteFile=function(e){e.preventDefault(),fetch("/admin/clearsrc").then(function(){p["a"].success("\u5220\u9664\u6210\u529f")})},n.state={file:void 0,filename:void 0,id:void 0},n}return k()(t,e),h()(t,[{key:"componentDidMount",value:function(){var e=this;this.initEditor(),this.setState({id:this.props.match.params.id});var t={id:this.props.match.params.id};this.props.dispatch({type:"".concat(T,"/queryAnnouncementList"),payload:t,callback:function(t){1!=t.result?I["a"].push("/systemmanagement/announcement/list"):(e.props.form.setFieldsValue({title:t.announcement.title}),e.editor.txt.html(t.announcement.content),e.pic=t.announcement.split("|"))}})}},{key:"render",value:function(){return console.log(this.state),C.a.createElement(x["a"],{title:"\u4fee\u6539\u516c\u544a"},C.a.createElement(c["a"],{bordered:!1},C.a.createElement(w["a"],{layout:"vertical",style:{marginTop:8},onSubmit:this.onSubmit,hideRequiredMark:!0},C.a.createElement(w["a"].Item,{label:"\u516c\u544a\u6807\u9898"},this.props.form.getFieldDecorator("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u516c\u544a\u6807\u9898"}]})(C.a.createElement(u["a"],{placeholder:"\u8bf7\u8f93\u5165\u516c\u544a\u6807\u9898",style:{width:1e3}}))),C.a.createElement(w["a"].Item,{label:"\u516c\u544a\u6b63\u6587"},C.a.createElement("div",{ref:"editorElem"})),C.a.createElement(w["a"].Item,{label:"\u516c\u544a\u9644\u4ef6"},C.a.createElement(s["a"],{onClick:this.uploadFile},"\u9009\u62e9\u9644\u4ef6")," ",C.a.createElement("br",null),this.state.filename," ",C.a.createElement("br",null),C.a.createElement(s["a"],{onClick:this.deleteFile},"\u5220\u9664\u9644\u4ef6"),C.a.createElement("input",{type:"file",id:"uploadFile",name:"file",onChange:this.onFileChange,style:{display:"none"},ref:"uploadBox"})),C.a.createElement(s["a"],{type:"primary",htmlType:"submit",style:{float:"right"}},"\u63d0\u4ea4"))))}}]),t}(C.a.Component),l=r))||l)||l);t["default"]=B}}]);